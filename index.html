<!DOCTYPE html>
<html >
  <head>
    <title>Divi Factory</title>

    <!-- <link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' rel='stylesheet' type='text/css'> -->
    <!-- <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script> -->
    <script src='./node_modules/web3/dist/web3.min.js'></script>

  </head>
  <body>
    <div>
      <button class="clickable"> get </button>
    </div>

<script>
const contractAddress = "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512";
const abi = [
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "_greeting",
        "type": "string"
      }
    ],
    "stateMutability": "nonpayable",
    "type": "constructor"
  },
  {
    "inputs": [],
    "name": "greet",
    "outputs": [
      {
        "internalType": "string",
        "name": "",
        "type": "string"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "_greeting",
        "type": "string"
      }
    ],
    "name": "setGreeting",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  }
]

window.addEventListener('DOMContentLoaded', () => {
  const clickables = document.getElementsByClassName('clickable');
  const updateButtons = () => {
    for(i = 0; i < clickables.length; i++) {
      clickables[i].onclick = async () => {
        await getMMAccount();
        await greet();
      };
    }
  };
  updateButtons();
});

async function getMMAccount() {
  const accounts = await window.ethereum.request({
    method: 'eth_requestAccounts',
  });
  const account = accounts[0];
  return account
}

async function greet() {
  let w3 = new Web3("http://127.0.0.1:8545");
  let walletAddress = await getMMAccount();
  const contract = new w3.eth.Contract(abi, contractAddress);
  const res = await contract.methods.greet().call();
  alert(`Greeting from contract: ${res}`);
}
</script>
</body>
</html>
